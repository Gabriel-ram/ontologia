<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Buscador de Reposter√≠a - Local + DBpedia</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        /* Estilos adicionales para diferenciar fuentes */
        .source-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .source-local {
            background: #C8E6C9;
            color: #2E7D32;
        }
        
        .source-dbpedia {
            background: #BBDEFB;
            color: #1565C0;
        }
        
        .card.dbpedia-result {
            border-left: 4px solid #2196F3;
        }
        
        .card.local-result {
            border-left: 4px solid #4CAF50;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: #F5F5F5;
            border-radius: 8px;
        }
        
        .section-header h2 {
            margin: 0;
            color: #424242;
            font-size: 1.2em;
        }
        
        .results-count {
            color: #757575;
            font-size: 0.9em;
        }
        
        .dbpedia-link {
            color: #1565C0;
            text-decoration: none;
            font-size: 0.85em;
            word-break: break-all;
        }
        
        .dbpedia-link:hover {
            text-decoration: underline;
        }
        
        /* NUEVO: Estilos para la imagen thumbnail */
        .thumbnail-container {
            width: 100%;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            background: #F5F5F5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 150px;
        }
        
        .thumbnail-container img {
            width: 100%;
            height: auto;
            max-height: 200px;
            object-fit: cover;
        }
        
        .no-thumbnail {
            color: #999;
            font-style: italic;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üç∞ Buscador de Reposter√≠a</h1>
        <form method="POST" class="search-container">
            <input type="text" name="term" placeholder="Busca brownies, pasteles, chocolate, ingredientes..." value="{{ term }}">
            <button type="submit">üîç Buscar</button>
        </form>
    </div>

    <div class="results-container">
        {% if results %}
            {% set local_results = results | selectattr('fuente', 'equalto', 'local') | list %}
            {% set dbpedia_results = results | selectattr('fuente', 'equalto', 'dbpedia') | list %}
            
            <!-- Resultados Locales -->
            {% if local_results %}
            <div class="section-header">
                <h2>Resultados de tu Ontolog√≠a Local</h2>
                <span class="results-count">{{ local_results|length }} resultado(s)</span>
            </div>
            
            <div class="results-grid">
                {% for item in local_results %}
                    <div class="card local-result">
                        <div class="card-header">
                            <h3>
                                {{ item.nombre }}
                                <span class="source-badge source-local">LOCAL</span>
                            </h3>
                        </div>

                        {% if item.clases %}
                        <div class="card-section">
                            <div class="section-title">Clasificaci√≥n</div>
                            <div class="tag-container">
                                {% for clase in item.clases %}
                                    <span class="tag">{{ clase }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.superclases %}
                        <div class="card-section">
                            <div class="section-title">Superclases</div>
                            <div class="tag-container">
                                {% for super in item.superclases %}
                                    <span class="tag">{{ super }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.es_producto %}
                            {% if item.ingredientes %}
                            <div class="card-section">
                                <div class="section-title">Ingredientes</div>
                                <ul>
                                    {% for ing in item.ingredientes %}
                                        <li>{{ ing }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}

                            {% if item.herramientas %}
                            <div class="card-section">
                                <div class="section-title">Herramientas</div>
                                <ul>
                                    {% for h in item.herramientas %}
                                        <li>{{ h }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}

                            {% if item.tecnicas %}
                            <div class="card-section">
                                <div class="section-title">T√©cnicas</div>
                                <ul>
                                    {% for t in item.tecnicas %}
                                        <li>{{ t }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        {% endif %}

                        {% if item.atributos %}
                        <div class="card-section">
                            <div class="section-title">Atributos</div>
                            <div class="attributes-grid">
                                {% for key, values in item.atributos.items() %}
                                    <div class="attribute-item">
                                        <div class="attribute-key">{{ key }}</div>
                                        <div class="attribute-values">{{ values|join(', ') }}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.usada_en %}
                        <div class="card-section">
                            <div class="section-title">Usado en</div>
                            <div class="tag-container">
                                {% for uso in item.usada_en %}
                                    <span class="tag">{{ uso }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Resultados de DBpedia -->
            {% if dbpedia_results %}
            <div class="section-header" style="margin-top: 40px;">
                <h2>Resultados desde DBpedia</h2>
                <span class="results-count">{{ dbpedia_results|length }} resultado(s)</span>
            </div>
            
            <div class="results-grid">
                {% for item in dbpedia_results %}
                    <div class="card dbpedia-result">
                        <div class="card-header">
                            <h3>
                                {{ item.nombre }}
                                <span class="source-badge source-dbpedia">DBPEDIA</span>
                            </h3>
                        </div>

                        <!-- NUEVO: Mostrar imagen thumbnail primero -->
                        <div class="thumbnail-container">
                            {% if item.thumbnail %}
                                <img src="{{ item.thumbnail }}" alt="{{ item.nombre }}" onerror="this.parentElement.innerHTML='<div class=\'no-thumbnail\'>üñºÔ∏è Imagen no disponible</div>'">
                            {% else %}
                                <div class="no-thumbnail">üñºÔ∏è Sin imagen disponible</div>
                            {% endif %}
                        </div>

                        {% if item.clases %}
                        <div class="card-section">
                            <div class="section-title">Tipo</div>
                            <div class="tag-container">
                                {% for clase in item.clases %}
                                    <span class="tag">{{ clase }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.ingredientes %}
                        <div class="card-section">
                            <div class="section-title">Ingredientes (DBpedia)</div>
                            <ul>
                                {% for ing in item.ingredientes[:8] %}
                                    <li>{{ ing }}</li>
                                {% endfor %}
                                {% if item.ingredientes|length > 8 %}
                                    <li style="color: #999; font-style: italic;">...y {{ item.ingredientes|length - 8 }} m√°s</li>
                                {% endif %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if item.atributos %}
                        <div class="card-section">
                            <div class="section-title">Informaci√≥n</div>
                            <div class="attributes-grid">
                                {% for key, values in item.atributos.items() %}
                                    {% if key != 'dbpedia_uri' %}
                                    <div class="attribute-item">
                                        <div class="attribute-key">{{ key }}</div>
                                        <div class="attribute-values">{{ values|join(', ') }}</div>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if item.atributos.dbpedia_uri %}
                                <div class="attribute-item">
                                    <div class="attribute-key">üîó Ver en DBpedia</div>
                                    <div class="attribute-values">
                                        <a href="{{ item.atributos.dbpedia_uri[0] }}" 
                                           target="_blank" 
                                           class="dbpedia-link">
                                            {{ item.atributos.dbpedia_uri[0] }}
                                        </a>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if not local_results and not dbpedia_results %}
            <div class="no-results">
                <p>üîç No se encontraron resultados en ninguna fuente</p>
            </div>
            {% endif %}

        {% else %}
            <div class="no-results">
                <p> Realiza una b√∫squeda para ver resultados</p>
            </div>
        {% endif %}
    </div>
</body>
</html>